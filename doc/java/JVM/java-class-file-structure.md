## Class类文件的结构

1.  **任何一个Class文件都对应着唯一的一个类或接口的定义信息(model-info.class,package-info.class等描述性文件例外),反过来说,类或接口并不一定都得定义在文件中(类与接口可以动态生成,直接送入类加载器中)**
2.  Class文件是一组以8个字节为基础单位的二进制流,只有两种数据类型: "无符号数" 和 "表"
    1.  无符号数属于基本的数据类型,以u1,u2,u4,u8来分别表述1,2,4,8个字节的无符号数,无符号数可以用来描述数字,索引引用,数量值或者按照UTF-8编码构成字符串值
    2.  表是由多个无符号数或者其他表作为数据项构成的复合数据类型,所有表的命名都习惯性以"_info"结尾
3.  结构
    1.  **魔数(4字节) 0xCAFEBABE**
        1.  唯一作用是**确定这个文件是否为一个能被虚拟机接受的Class文件**
    2.  **Class文件的版本号(4字节)**
        1.  5,6为次版本号
        2.  7,8为主版本号
        3.  《Java虚拟机规范》在CLass文件校验部分明确要求了即使文件格式并未发生任何变化,虚拟机也必须拒绝执行超过其版本号的Class文件
    3.  **常量池**
        1.  由于常量池中常量的数量是不固定的,所以放置了一项**u2类型的数据,代表常量池容量计数,计数从1开始**
            1.  如果某些指向常量池的索引值的数据在特定情况下需要表达"不引用任何一个常量池项目"的含义,可以把索引值设为0来表示
        2.  字面量
            1.  如文本字符串,被声明为final的常量值等
        3.  符号引用
            1.  被模块导出或者开放的包
            2.  类和接口的全限定名
            3.  字段的名称和描述符
            4.  方法的名称和描述符
            5.  方法句柄和方法类型
            6.  动态调用点和动态常量
    4.  **访问标志**
        1.  用于识别类或者接口层次的访问信息,包括是类还是接口;是否为public;是否为abstract;是否为final等
    5.  **类索引/父类索引与接口索引集合**
        1.  类索引和父类索引都是**一个u2类型的数据**,接口索引集合是**一组u2类型**的数据的集合
        2.  Class文件中由这三项数据类确定该类型的继承关系
            1.  类索引确定类的全限定名
            2.  父类索引用于确定类的父类的全限定名
            3.  接口索引集合用来描述这个类实现了哪些接口
    6.  **字段表集合**
        1.  接口或者类中声明的变量
        2.  访问标志/名称索引/描述符索引/属性表集合
    7.  **方法表集合**
        1.  访问标志/名称索引/描述符索引/属性表集合
    8.  **属性表集合**
        1.  Code属性
            1.  max_stack : 操作数栈深度的最大值,虚拟机根据这个值来分配栈帧中的操作栈深度
            2.  max_locals : 局部变量表所需的存储空间,单位是变量槽(Slot),变量槽是虚拟机为局部变量分配内存所使用的最小单位
            3.  code_length 和 code用来存储Java源代码编译后生成的字符串指令
                1.  **code_length是一个u4类型的长度值,但实际上只使用了u2的长度**,如果超过这个限制,Javac编译器就会拒绝编译
            4.  显式异常处理表
        2.  Exception属性
            1.  作用是列举出方法中可能抛出的受检异常
        3.  LineNumberTable属性
            1.  用于描述Java源码与字节码行号之间的对应关系
            2.  默认生成,关闭生成后当抛出异常时堆栈中不会显示出错的行数,在调试程序时也无法按照源码行来断点
        4.  LocalVariableTable属性
            1.  用于描述栈帧中局部变量表的变量与Java源码中定义的变量之间的关系
            2.  默认生成.关闭后当其他人引用这个方法时,所有的参数名称都将会丢失
        5.  LocalVariableTypeTable属性(与LocalVariableTable类似)
            1.   使用字段的特征签名来完成泛型的描述
        6.  SourceFile属性
            1.  记录生成这个Class文件的源码文件名称
            2.  可关闭,关闭后,抛出异常时堆栈中不会显示出错代码所属的文件名
        7.  SourceDebugExtension属性
            1.  用于存储额外的代码调试信息,如JSP文件调试
        8.  ConstantValue属性
            1.  作用是通知虚拟机自动为静态变量赋值
            2.  被static修饰的变量才可以使用这个属性
        9.  InnerClasses属性
            1.  用于记录内部类与宿主类之间的关联
            2.  如果一个类中定义了内部类,编译器就会为它以及它所包含的内部类生成InnerClasses属性
        10.  Deprecated属性
             1.  标志类型的布尔属性,用于表示某个类/字段/方法不再推荐使用
        11.  Synthetic属性
             1.  代表此字段/方法不是Java源码直接产生的,而是由编译器自行添加的
        12.  StackMapTable属性
             1.  在虚拟机类加载的字节码验证阶段被新类型检查验证器使用,目的在于代替以前比较消耗性能的基于数据流分析的类型推到验证器
             2.  一个方法的Code属性最多只能有一个StackMapTable属性,否则怕出ClassFormatError异常
        13.  Signature属性
             1.  用于记录泛型签名信息
             2.  Java语言的泛型采用的是擦除法实现的伪泛型,Code属性中所有的泛型信息编译在编译之后都被擦除掉
        14.  BootstrapMethods属性
             1.  用于保存invokedynamic指令引用的引导方法限定符
        15.  MethodParameters属性
             1.  用于记录方法的各个形参名称和信息
        16.  模块化相关属性
             1.  Module/ModulePackages/ModuleMainClass
             2.  JDK9新加的
        17.  运行时注解相关属性
             1.  JDK5 : RuntimeVisibleAnnotations/RuntimeInvisibleAnnotations/RuntimeVisibleParameterAnnotations/RuntimeInvisibleParameter- Annotations
             2.  JDK8 : RuntimeVisibleTypeAnnotations/RuntimeInvisibleTypeAnnotations